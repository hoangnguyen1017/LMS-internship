{% block extra_js %}
<script>
    let lastFetchTime = null; // Store the last fetch time

    function fetchActivityLogs() {
        fetch("{% url 'activity:fetch_activity_logs' %}")
            .then(response => response.json())
            .then(data => {
                const tableBody = document.querySelector('.activity-table tbody');
                tableBody.innerHTML = ''; // Clear the existing rows
                data.forEach((log, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${log.activity_type}</td>
                        <td>${log.activity_details}</td>
                        <td>${log.activity_timestamp}</td>
                    `;
                    tableBody.appendChild(row);
                });
            })
            .catch(error => console.error('Error fetching activity logs:', error));
    }

    function logUserActivity(activityType, activityDetails) {
        // Replace with your logging mechanism, e.g., an AJAX request to log the activity
        console.log(`Logging activity: ${activityType} - ${activityDetails}`);
    }

    document.addEventListener('DOMContentLoaded', function() {
        // Log the initial page visit only
        logUserActivity('Page Visit', 'Accessed activity page'); // Replace with your logging mechanism
        fetchActivityLogs(); // Initial fetch of activity logs

        // Fetch logs every 10 seconds
        setInterval(fetchActivityLogs, 10000);
    });

    // Log user interactions such as search or filter
    document.querySelector('.search-form').addEventListener('submit', function(event) {
        event.preventDefault(); // Prevent default form submission
        const searchQuery = document.querySelector('input[name="search"]').value;
        const fromDate = document.querySelector('input[name="from_date"]').value;
        const toDate = document.querySelector('input[name="to_date"]').value;

        // Log search activity
        logUserActivity('Search Activity', `Search Query: ${searchQuery}, From: ${fromDate}, To: ${toDate}`); // Replace with your logging mechanism
        
        // Now fetch the logs after logging the search
        fetchActivityLogs();
    });
</script>
{% endblock %}
